var width=1e3,height=600,circleScale=1e9,path=d3.geo.path().projection(null),radius=d3.scale.sqrt().domain([0,3e6]).range([0,60]),arc=d3.svg.arc().outerRadius(radius),svg=d3.select("#graph").append("svg").attr("height",height).attr("width",width),toolTip=d3.select("#graph").append("div").style("position","absolute").style("padding","5px 10px").style("background","#fff").style("color","#222").style("opacity",0).style("font-family","Open Sans").style("z-index",1e3);d3.json("../js/unitedstates.json",function(t,e){return t?console.log(t):(svg.append("path").datum(topojson.feature(e,e.objects.nation)).attr("class","land").attr("d",path),svg.selectAll(".states").data(topojson.feature(e,e.objects.counties).features).enter().append("path").attr("id",function(t){return t.id}).attr("class","states states-hover").attr("d",path),svg.append("path").datum(topojson.mesh(e,e.objects.states,function(t,e){return t!==e})).attr("class","border-states").attr("d",path),void svg.append("g").attr("class","bubble").selectAll("circle").data(topojson.feature(e,e.objects.counties).features.sort(function(t,e){return e.properties.population-t.properties.population})).enter().append("circle").on("mouseover",function(t,e){d3.select(this).attr("class","hover"),toolTip.transition().style("opacity",.9).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px"),tempColor=this.style.fill,toolTip.html(null!=t.properties.name||void 0!=t.properties.name?t.properties.name+", "+t.properties.population:"")}).on("mouseout",function(t,e){d3.select(this).attr("class",""),d3.select(this).transition().delay(400).duration(800).style("opacity",1).style("fill",tempColor)}).attr("transform",function(t){return"translate("+path.centroid(t)+")"}).attr("r",function(t){return radius(Math.sqrt(t.properties.population*circleScale*Math.PI))}))}),$(document).ready(function(){var t=parseInt(d3.select("#graph").style("width")),e=.5,a=t*e,s=d3.geo.equirectangular().scale(t),n=d3.geo.path().projection(s),r=d3.select("#graph").insert("svg:svg").attr("width",t).attr("height",a),o=r.append("svg:g").attr("id","states"),i=r.append("svg:g").attr("id","circles"),l=r.append("svg:g").attr("id","labels");d3.json("js/unitedstates.json",function(t){o.selectAll("path").data(t.features).enter().append("svg:path").attr("d",n).on("mouseover",function(t){d3.select(this).style("fill","#1e90ff").append("svg:title").text(t.properties.name)}).on("mouseout",function(t){d3.select(this).style("fill","#444")})});var p=40;d3.csv("js/world-memberdata.csv",function(t){i.selectAll("circle").data(t).enter().append("svg:circle").attr("cx",function(t,e){return s([+t.longitude,+t.latitude])[0]}).attr("cy",function(t,e){return s([+t.longitude,+t.latitude])[1]}).attr("r",function(t){return Math.sqrt(Math.PI*+t[2016]*p)}).attr("title",function(t){return t.country+": "+Math.round(t[2016])}).on("mouseover",function(t){d3.select(this).style("fill","#FC0")}).on("mouseout",function(t){d3.select(this).style("fill","#00bfff")}),l.selectAll("labels").data(t).enter().append("svg:text").attr("x",function(t,e){return s([+t.longitude,+t.latitude])[0]}).attr("y",function(t,e){return s([+t.longitude,+t.latitude])[1]}).attr("dy","0.3em").attr("text-anchor","middle").text(function(t){return Math.round(t[2016])})})});